<?php
namespace App\Libraries;

trait TradeDate
{
    public static function isTradeDate($day = null)
    {
        if (!$day) {
            $day = date('Y-m-d');
        }

        $holidays = [
            //2018
            '2018-10-05' => '1',
            '2018-10-04' => '1',
            '2018-10-03' => '1',
            '2018-10-02' => '1',
            '2018-10-01' => '1',
            '2018-09-24' => '1',
            '2018-06-18' => '1',
            '2018-05-01' => '1',
            '2018-04-30' => '1',
            '2018-04-06' => '1',
            '2018-04-05' => '1',
            '2018-02-21' => '1',
            '2018-02-20' => '1',
            '2018-02-19' => '1',
            '2018-02-16' => '1',
            '2018-02-15' => '1',
            '2018-01-01' => '1',

            //2017
            '2017-10-06' => '1',
            '2017-10-05' => '1',
            '2017-10-04' => '1',
            '2017-10-03' => '1',
            '2017-10-02' => '1',
            '2017-05-30' => '1',
            '2017-05-29' => '1',
            '2017-05-01' => '1',
            '2017-04-04' => '1',
            '2017-04-03' => '1',
            '2017-02-02' => '1',
            '2017-02-01' => '1',
            '2017-01-31' => '1',
            '2017-01-30' => '1',
            '2017-01-27' => '1',
            '2017-01-02' => '1',

            //2016
            '2016-10-07' => '1',
            '2016-10-06' => '1',
            '2016-10-05' => '1',
            '2016-10-04' => '1',
            '2016-10-03' => '1',
            '2016-09-16' => '1',
            '2016-09-15' => '1',
            '2016-06-10' => '1',
            '2016-06-09' => '1',
            '2016-05-02' => '1',
            '2016-04-04' => '1',
            '2016-02-12' => '1',
            '2016-02-11' => '1',
            '2016-02-10' => '1',
            '2016-02-09' => '1',
            '2016-02-08' => '1',
            '2016-01-01' => '1',

            '2015-10-07' => '1',
            '2015-10-06' => '1',
            '2015-10-05' => '1',
            '2015-10-02' => '1',
            '2015-10-01' => '1',
            '2015-09-04' => '1',
            '2015-09-03' => '1',
            '2015-06-22' => '1',
            '2015-05-01' => '1',
            '2015-04-06' => '1',
            '2015-02-24' => '1',
            '2015-02-23' => '1',
            '2015-02-20' => '1',
            '2015-02-19' => '1',
            '2015-02-18' => '1',
            '2015-01-02' => '1',
            '2015-01-01' => '1',
            '2014-10-07' => '1',
            '2014-10-06' => '1',
            '2014-10-03' => '1',
            '2014-10-02' => '1',
            '2014-10-01' => '1',
            '2014-09-08' => '1',
            '2014-06-02' => '1',
            '2014-05-02' => '1',
            '2014-05-01' => '1',
            '2014-04-07' => '1',
            '2014-02-06' => '1',
            '2014-02-05' => '1',
            '2014-02-04' => '1',
            '2014-02-03' => '1',
            '2014-01-31' => '1',
            '2014-01-01' => '1',
            '2013-10-07' => '1',
            '2013-10-04' => '1',
            '2013-10-03' => '1',
            '2013-10-02' => '1',
            '2013-10-01' => '1',
            '2013-09-20' => '1',
            '2013-09-19' => '1',
            '2013-06-12' => '1',
            '2013-06-11' => '1',
            '2013-06-10' => '1',
            '2013-05-01' => '1',
            '2013-04-30' => '1',
            '2013-04-29' => '1',
            '2013-04-05' => '1',
            '2013-04-04' => '1',
            '2013-02-15' => '1',
            '2013-02-14' => '1',
            '2013-02-13' => '1',
            '2013-02-12' => '1',
            '2013-02-11' => '1',
            '2013-01-03' => '1',
            '2013-01-02' => '1',
            '2013-01-01' => '1',
            '2012-10-05' => '1',
            '2012-10-04' => '1',
            '2012-10-03' => '1',
            '2012-10-02' => '1',
            '2012-10-01' => '1',
            '2012-06-22' => '1',
            '2012-05-01' => '1',
            '2012-04-30' => '1',
            '2012-04-04' => '1',
            '2012-04-03' => '1',
            '2012-04-02' => '1',
            '2012-01-27' => '1',
            '2012-01-26' => '1',
            '2012-01-25' => '1',
            '2012-01-24' => '1',
            '2012-01-23' => '1',
            '2012-01-03' => '1',
            '2012-01-02' => '1',
            '2011-10-07' => '1',
            '2011-10-06' => '1',
            '2011-10-05' => '1',
            '2011-10-04' => '1',
            '2011-10-03' => '1',
            '2011-09-12' => '1',
            '2011-06-06' => '1',
            '2011-05-02' => '1',
            '2011-04-05' => '1',
            '2011-04-04' => '1',
            '2011-02-08' => '1',
            '2011-02-07' => '1',
            '2011-02-04' => '1',
            '2011-02-03' => '1',
            '2011-02-02' => '1',
            '2011-01-03' => '1',
            '2010-10-07' => '1',
            '2010-10-06' => '1',
            '2010-10-05' => '1',
            '2010-10-04' => '1',
            '2010-10-03' => '1',
            '2010-10-02' => '1',
            '2010-10-01' => '1',
            '2010-09-24' => '1',
            '2010-09-23' => '1',
            '2010-09-22' => '1',
            '2010-06-16' => '1',
            '2010-06-15' => '1',
            '2010-06-14' => '1',
            '2010-05-03' => '1',
            '2010-05-02' => '1',
            '2010-05-01' => '1',
            '2010-04-05' => '1',
            '2010-04-04' => '1',
            '2010-04-03' => '1',
            '2010-02-19' => '1',
            '2010-02-18' => '1',
            '2010-02-17' => '1',
            '2010-02-16' => '1',
            '2010-02-15' => '1',
            '2010-02-14' => '1',
            '2010-02-13' => '1',
            '2010-01-03' => '1',
            '2010-01-02' => '1',
            '2010-01-01' => '1',
        ];

        if (isset($holidays[$day])) {
            return false;
        }

        $dw = date( "w", strtotime($day));

        if ($dw == 0 || $dw == 6) {
            return false;
        }

        return true;
    }

    public static function nextTradeDate($day, $step=0)
    {
        if ($step < 0) {
            return '';
        }

        $current = strtotime($day);

        while (true) {
            if (self::isTradeDate(date('Y-m-d', $current))) {
                $step--;
            }

            if ($step < 0) {
                break;
            }

            $current = strtotime( "1 day ", $current );
        }

        return date('Y-m-d', $current);
    }

    public static function lastTradeDate($day, $step = -1)
    {
        if ($step >= 0 ) {
            return '';
        }

        $current = strtotime( "-1 day ", strtotime($day));

        while (true) {
            if (self::isTradeDate(date('Y-m-d', $current))) {
                $step++;
            }

            if ($step >= 0) {
                break;
            }

            $current = strtotime( "-1 day ", $current );
        }

        return date('Y-m-d', $current);
    }

    public static function tradeDate($day, $step = 0)
    {
        if ($step < 0) {
            return self::lastTradeDate($day, $step);
        } else {
            return self::nextTradeDate($day, $step);
        }
    }

    public static function tradeDatewithTime($day, $time, $step = 0)
    {
        if (strtotime($day. ' ' .$time) >= strtotime($day .' '. '15:00:00')) {
            $day = date('Y-m-d', strtotime("1 day", strtotime($day)));
        }

        return self::tradeDate($day, $step);
    }
}

